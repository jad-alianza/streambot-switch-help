# Medium (behave) tests directory

Please add appropriate feature files to the features directory.
If you need your buildkite CI build to pass and there are no actual tests please uncomment everything in the features/empty.feature

## Update template files 
If your repository is just created with a template https://github.com/alianza-dev/data-shared-streaming-project-template make sure you update files in this directory as described below:

* __features__ 
  * __example_data__ 
    * __foo_bar_data.json__ - _replace `foo_bar` in filename with actual entity name. You can use test data as in tests/foo_bar_transformer_lambda_tests_data/input/test1_sns_message_decoded.json file but make sure you change actual Message to dictionary from string. Also in some cases there are message attributes, so they should also be copied. Replace value of partitionID field in test data with the following string: `<replace_aqa_id>`.__
  * __test_project_streaming.feature__ - _replace `test_project` in filename with actual streaming project name, for example `switch_help`. Also in the file replace the following strings: `test-project`, `test_project` with actual values (for example `switch-help` and `switch_help`). Replace all instances of `foo-bar` and `foo_bar` in the file with actual entity name (for example, `sip-trunk` and `sip_trunk`). After project is deployed to q2 environment for the first time, find out actual SubscriptionRoleArn and replace the following string in scenario with actual value: __arn:aws:iam::687288345179:role/q2-streaming-test-project-RoleDeliveryStreamSubscr-15XY6A08SED48__. If your app processes multiple entities you need to add separate scenario for each transformer lambda and add additional steps in the scenario for snapshotter lambda. Currently, test scenario for snapshotter lambda is written to test two entities - foo_bar and foo_bar2. Please remove steps related to foo_bar2 if there is only one entity processed by your application or add additional steps for additional entities. Make sure all tables in scenario contain columns that correspond to actual table. In rare cases if there is a column with complex type (array of structs) it is better to omit such column because there may be a problem to insert test data. In the following step: __And the following data appears in the 'q2_test_project_stream.foo_bar' Athena table:__ specify all table columns and expected values. Make sure that date in _year, _month, _day columns and also in the _date column corresponds to test data. Depending on project and entity it may be either today date or date from one of fields (for example "Timestamp" field) from example test data. Sometimes you may need to remove the "event_on" column from the table (this needs to be done when "event_on" is based on the current date and time and not based on one of timestamps from the incoming SNS message). Once test scenario is ready to be executed please remove the @not_implemented tag._
